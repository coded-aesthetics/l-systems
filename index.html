<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Interactive 3D L-Systems</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                font-family: "Arial", sans-serif;
                background: #1a1a1a;
                color: #ffffff;
                overflow: hidden;
            }

            #container {
                display: flex;
                height: 100vh;
            }

            #canvas-container {
                flex: 1;
                position: relative;
                background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            }

            #canvas {
                display: block;
                width: 100%;
                height: 100%;
            }

            #controls {
                width: 320px;
                background: #2a2a2a;
                padding: 20px;
                overflow-y: auto;
                box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
            }

            .control-group {
                margin-bottom: 20px;
                padding: 15px;
                background: #333333;
                border-radius: 8px;
                border-left: 3px solid #4caf50;
            }

            .control-group h3 {
                margin: 0 0 15px 0;
                color: #4caf50;
                font-size: 16px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            label {
                display: block;
                margin-bottom: 8px;
                font-size: 12px;
                color: #cccccc;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            input,
            textarea,
            select {
                width: 100%;
                padding: 8px;
                background: #1a1a1a;
                border: 1px solid #555555;
                border-radius: 4px;
                color: #ffffff;
                font-size: 13px;
                box-sizing: border-box;
            }

            input[type="range"] {
                margin: 5px 0;
            }

            textarea {
                height: 60px;
                resize: vertical;
                font-family: "Courier New", monospace;
            }

            button {
                width: 100%;
                padding: 10px;
                background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                text-transform: uppercase;
                letter-spacing: 1px;
                transition: all 0.3s ease;
                margin-top: 10px;
            }

            button:hover {
                background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
                transform: translateY(-1px);
            }

            button:active {
                transform: translateY(0);
            }

            .preset-buttons {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 5px;
                margin-top: 10px;
            }

            .help-section {
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid #555;
            }

            .help-button {
                background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                font-size: 12px;
                padding: 8px;
                margin: 0;
            }

            .help-button:hover {
                background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            }

            /* Modal styles */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
            }

            .modal-content {
                background-color: #2a2a2a;
                margin: 2% auto;
                padding: 0;
                border-radius: 8px;
                width: 90%;
                max-width: 800px;
                max-height: 90%;
                overflow: hidden;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            }

            .modal-header {
                background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
                padding: 20px;
                color: white;
                border-radius: 8px 8px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header h2 {
                margin: 0;
                font-size: 24px;
            }

            .close {
                color: white;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
                padding: 0 10px;
                border-radius: 4px;
                transition: background-color 0.3s;
            }

            .close:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .modal-body {
                padding: 20px;
                max-height: calc(90vh - 100px);
                overflow-y: auto;
                color: #ffffff;
            }

            .help-section-title {
                color: #4caf50;
                font-size: 18px;
                margin: 20px 0 10px 0;
                border-bottom: 1px solid #4caf50;
                padding-bottom: 5px;
            }

            .help-section-title:first-child {
                margin-top: 0;
            }

            .symbol-table {
                width: 100%;
                border-collapse: collapse;
                margin: 10px 0;
                background: #333;
                border-radius: 4px;
                overflow: hidden;
            }

            .symbol-table th,
            .symbol-table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #555;
            }

            .symbol-table th {
                background: #444;
                font-weight: bold;
                color: #4caf50;
            }

            .symbol-table tr:last-child td {
                border-bottom: none;
            }

            .symbol-code {
                font-family: "Courier New", monospace;
                background: #1a1a1a;
                padding: 2px 6px;
                border-radius: 3px;
                color: #4caf50;
                font-weight: bold;
            }

            .example-box {
                background: #333;
                border-left: 3px solid #4caf50;
                padding: 15px;
                margin: 15px 0;
                border-radius: 0 4px 4px 0;
            }

            .example-code {
                font-family: "Courier New", monospace;
                background: #1a1a1a;
                padding: 10px;
                border-radius: 4px;
                color: #4caf50;
                margin: 10px 0;
                white-space: pre-wrap;
            }

            .preset-buttons button {
                font-size: 11px;
                padding: 6px;
                margin: 0;
            }

            .value-display {
                display: inline-block;
                float: right;
                color: #4caf50;
                font-weight: bold;
            }

            #loading {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: #4caf50;
                font-size: 18px;
                z-index: 1000;
            }

            .error {
                color: #ff6b6b;
                font-size: 12px;
                margin-top: 5px;
                display: none;
            }

            #fps-counter {
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.7);
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 12px;
                color: #4caf50;
            }

            /* Save/Load Controls Styles */
            #plantName {
                width: 100%;
                padding: 8px;
                margin-bottom: 10px;
                border: 1px solid #555;
                border-radius: 4px;
                background: #2a2a2a;
                color: #fff;
                font-size: 14px;
            }

            #plantName:focus {
                outline: none;
                border-color: #4caf50;
                box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
            }

            #loadSelect {
                width: 100%;
                margin-bottom: 10px;
                padding: 8px;
                border: 1px solid #555;
                border-radius: 4px;
                background: #2a2a2a;
                color: #fff;
                font-size: 14px;
            }

            #loadSelect:focus {
                outline: none;
                border-color: #4caf50;
            }

            .save-load-buttons {
                display: flex;
                gap: 5px;
                margin-bottom: 10px;
            }

            #saveButton {
                width: 100%;
                margin-bottom: 10px;
                background: #4caf50;
                color: white;
                border: none;
                padding: 10px;
                border-radius: 4px;
                font-size: 14px;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            #saveButton:hover {
                background: #45a049;
            }

            #loadButton,
            #deleteButton,
            #exportButton,
            #importButton {
                flex: 1;
                padding: 8px;
                border: none;
                border-radius: 4px;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.3s;
            }

            #loadButton {
                background: #2196f3;
                color: white;
            }

            #loadButton:hover:not(:disabled) {
                background: #1976d2;
            }

            #loadButton:disabled {
                background: #555;
                color: #999;
                cursor: not-allowed;
            }

            #deleteButton {
                background: #e74c3c;
                color: white;
            }

            #deleteButton:hover:not(:disabled) {
                background: #c0392b;
            }

            #deleteButton:disabled {
                background: #555;
                color: #999;
                cursor: not-allowed;
            }

            #exportButton {
                background: #ff9800;
                color: white;
            }

            #exportButton:hover {
                background: #e68900;
            }

            #importButton {
                background: #9c27b0;
                color: white;
            }

            #importButton:hover {
                background: #7b1fa2;
            }

            .save-load-section {
                border-top: 1px solid #333;
                margin-top: 15px;
                padding-top: 15px;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <div id="canvas-container">
                <canvas id="canvas"></canvas>
                <div id="loading">Initializing WebGL...</div>
                <div id="fps-counter">FPS: --</div>
            </div>

            <div id="controls">
                <div class="control-group">
                    <h3>L-System Rules</h3>
                    <label for="axiom">Axiom (Starting String)</label>
                    <textarea id="axiom" placeholder="F">F</textarea>

                    <label for="rules">Rules (one per line: A -> B)</label>
                    <textarea id="rules" placeholder="F -> F[+F]F[-F]F">
F -> F[+F]F[-F]F</textarea
                    >

                    <label for="iterations"
                        >Iterations
                        <span class="value-display" id="iterations-value"
                            >4</span
                        ></label
                    >
                    <input
                        type="range"
                        id="iterations"
                        min="1"
                        max="8"
                        value="4"
                        step="1"
                    />

                    <button id="generate">Generate L-System</button>

                    <div class="preset-buttons">
                        <button onclick="loadPreset('tree')">Tree</button>
                        <button onclick="loadPreset('fern')">Fern</button>
                        <button onclick="loadPreset('dragon')">Dragon</button>
                        <button onclick="loadPreset('plant')">Plant</button>
                        <button onclick="loadPreset('tree3d')">3D Tree</button>
                        <button onclick="loadPreset('bush3d')">3D Bush</button>
                        <button onclick="loadPreset('bushWithLeaves')">
                            Bush with Leaves
                        </button>
                        <button onclick="loadPreset('treeWithLeaves')">
                            Tree with Leaves
                        </button>
                        <button onclick="loadPreset('leafyBranch')">
                            Leafy Branch
                        </button>
                        <button onclick="loadPreset('simpleLeafTest')">
                            Simple Leaf Test
                        </button>
                        <button onclick="loadPreset('minimalLeaf')">
                            Minimal Leaf
                        </button>
                        <button onclick="loadPreset('sphereLeaves')">
                            Sphere Leaves
                        </button>
                        <button onclick="loadPreset('autumnTree')">
                            Autumn Tree
                        </button>
                        <button onclick="loadPreset('windyLeaves')">
                            Windy Leaves
                        </button>
                        <button onclick="loadPreset('coral3d')">
                            3D Coral
                        </button>
                        <button onclick="loadPreset('spiral3d')">
                            3D Spiral
                        </button>
                        <button
                            onclick="loadPreset('coloredTree')"
                            style="
                                background: linear-gradient(
                                    45deg,
                                    #8b4513,
                                    #228b22
                                );
                                color: white;
                            "
                        >
                            üé® Colored Tree
                        </button>
                        <button
                            onclick="loadPreset('autumnTreeColored')"
                            style="
                                background: linear-gradient(
                                    45deg,
                                    #dc2626,
                                    #ea580c,
                                    #facc15
                                );
                                color: white;
                            "
                        >
                            üçÇ Autumn Colors
                        </button>
                        <button
                            onclick="loadPreset('coloredFern')"
                            style="
                                background: linear-gradient(
                                    45deg,
                                    #166534,
                                    #4ade80
                                );
                                color: white;
                            "
                        >
                            üåø Colored Fern
                        </button>
                        <button
                            onclick="loadPreset('rainbowBush')"
                            style="
                                background: linear-gradient(
                                    45deg,
                                    #dc2626,
                                    #ea580c,
                                    #facc15,
                                    #4ade80,
                                    #3b82f6
                                );
                                color: white;
                            "
                        >
                            üåà Rainbow Bush
                        </button>
                    </div>

                    <div class="help-section">
                        <button class="help-button" onclick="showHelp()">
                            üìñ L-System Reference
                        </button>
                    </div>

                    <div class="error" id="rules-error"></div>
                </div>

                <div class="control-group">
                    <h3>Geometry Parameters</h3>

                    <label for="angle"
                        >Branch Angle
                        <span class="value-display" id="angle-value"
                            >25¬∞</span
                        ></label
                    >
                    <input
                        type="range"
                        id="angle"
                        min="10"
                        max="90"
                        value="25"
                        step="1"
                    />

                    <label for="length"
                        >Branch Length
                        <span class="value-display" id="length-value"
                            >1.0</span
                        ></label
                    >
                    <input
                        type="range"
                        id="length"
                        min="0.1"
                        max="3.0"
                        value="1.0"
                        step="0.1"
                    />

                    <label for="thickness"
                        >Branch Thickness
                        <span class="value-display" id="thickness-value"
                            >0.05</span
                        ></label
                    >
                    <input
                        type="range"
                        id="thickness"
                        min="0.01"
                        max="0.2"
                        value="0.05"
                        step="0.01"
                    />

                    <label for="tapering"
                        >Thickness Tapering
                        <span class="value-display" id="tapering-value"
                            >0.8</span
                        ></label
                    >
                    <input
                        type="range"
                        id="tapering"
                        min="0.3"
                        max="1.0"
                        value="0.9"
                        step="0.01"
                    />

                    <label for="angleVariation"
                        >Angle Variation
                        <span class="value-display" id="angleVariation-value"
                            >0¬∞</span
                        ></label
                    >
                    <input
                        type="range"
                        id="angleVariation"
                        min="0"
                        max="15"
                        value="0"
                        step="0.5"
                    />

                    <label for="lengthVariation"
                        >Length Variation
                        <span class="value-display" id="lengthVariation-value"
                            >0%</span
                        ></label
                    >
                    <input
                        type="range"
                        id="lengthVariation"
                        min="0"
                        max="50"
                        value="0"
                        step="1"
                    />
                </div>

                <div class="control-group">
                    <h3>Rendering Options</h3>

                    <label for="segments"
                        >Cylinder Segments
                        <span class="value-display" id="segments-value"
                            >8</span
                        ></label
                    >
                    <input
                        type="range"
                        id="segments"
                        min="3"
                        max="16"
                        value="8"
                        step="1"
                    />

                    <label for="colorMode">Color Mode</label>
                    <select id="colorMode">
                        <option value="0">Height Gradient</option>
                        <option value="1">Branch Depth</option>
                        <option value="2">Uniform Green</option>
                        <option value="3">Rainbow</option>
                        <option value="4">Parameterized Colors</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>Leaf Parameters</h3>

                    <label for="leafProbability"
                        >Leaf Probability
                        <span class="value-display" id="leafProbability-value"
                            >80%</span
                        ></label
                    >
                    <input
                        type="range"
                        id="leafProbability"
                        min="0"
                        max="100"
                        value="80"
                        step="5"
                    />

                    <label for="leafThreshold"
                        >Leaf Generation Threshold
                        <span class="value-display" id="leafThreshold-value"
                            >2</span
                        ></label
                    >
                    <input
                        type="range"
                        id="leafThreshold"
                        min="0"
                        max="6"
                        value="2"
                        step="1"
                    />

                    <label for="leafColor">Leaf Color</label>
                    <input
                        type="color"
                        id="leafColor"
                        value="#2ecc40"
                        style="
                            width: 60px;
                            height: 40px;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                        "
                    />

                    <div style="margin-top: 10px">
                        <strong>Presets:</strong>
                        <div
                            style="
                                display: flex;
                                gap: 5px;
                                margin-top: 5px;
                                flex-wrap: wrap;
                            "
                        >
                            <button
                                onclick="setLeafColor('#2ecc40')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #2ecc40;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Green"
                            ></button>
                            <button
                                onclick="setLeafColor('#e74c3c')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #e74c3c;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Red"
                            ></button>
                            <button
                                onclick="setLeafColor('#f39c12')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #f39c12;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Orange"
                            ></button>
                            <button
                                onclick="setLeafColor('#f1c40f')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #f1c40f;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Yellow"
                            ></button>
                            <button
                                onclick="setLeafColor('#9b59b6')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #9b59b6;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Purple"
                            ></button>
                            <button
                                onclick="setLeafColor('#3498db')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #3498db;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Blue"
                            ></button>
                            <button
                                onclick="setLeafColor('#1abc9c')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #1abc9c;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Teal"
                            ></button>
                            <button
                                onclick="setLeafColor('#e91e63')"
                                style="
                                    width: 30px;
                                    height: 30px;
                                    background: #e91e63;
                                    border: 2px solid #ccc;
                                    border-radius: 50%;
                                    cursor: pointer;
                                "
                                title="Pink"
                            ></button>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Camera Controls</h3>
                    <label for="zoom"
                        >Zoom
                        <span class="value-display" id="zoom-value"
                            >5.0</span
                        ></label
                    >
                    <input
                        type="range"
                        id="zoom"
                        min="1.0"
                        max="30.0"
                        value="5.0"
                        step="0.1"
                    />

                    <label for="rotationSpeed"
                        >Auto Rotation
                        <span class="value-display" id="rotationSpeed-value"
                            >0.5</span
                        ></label
                    >
                    <input
                        type="range"
                        id="rotationSpeed"
                        min="0"
                        max="2"
                        value="0.5"
                        step="0.1"
                    />

                    <button id="resetCamera">Reset Camera</button>
                </div>

                <div class="control-group save-load-section">
                    <h3>üíæ Save & Load Plants</h3>

                    <p
                        style="
                            font-size: 12px;
                            color: #888;
                            margin-bottom: 10px;
                        "
                    >
                        Save your current plant configuration including all
                        parameters, leaf colors, and camera position.
                    </p>

                    <label for="plantName">Plant Name</label>
                    <input
                        type="text"
                        id="plantName"
                        placeholder="Enter plant name..."
                    />

                    <button id="saveButton">üíæ Save Current Plant</button>

                    <label for="loadSelect">Saved Plants</label>
                    <select id="loadSelect">
                        <option value="">Select a plant...</option>
                    </select>

                    <div class="save-load-buttons">
                        <button id="loadButton" disabled>üìÇ Load</button>
                        <button id="deleteButton" disabled>üóëÔ∏è Delete</button>
                    </div>

                    <div class="save-load-buttons">
                        <button id="exportButton">üì§ Export All</button>
                        <button id="importButton">üì• Import</button>
                    </div>

                    <input
                        type="file"
                        id="importFile"
                        accept=".json"
                        style="display: none"
                    />

                    <p
                        style="
                            font-size: 11px;
                            color: #666;
                            margin-top: 10px;
                            line-height: 1.3;
                        "
                    >
                        <strong>Tips:</strong><br />
                        ‚Ä¢ Press Enter in name field to save quickly<br />
                        ‚Ä¢ Export creates a backup file you can share<br />
                        ‚Ä¢ Import merges plants from backup files<br />
                        ‚Ä¢ Camera position and all settings are preserved
                    </p>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>L-System Reference Guide</h2>
                    <span class="close" onclick="closeHelp()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="help-section-title">
                        Basic Turtle Graphics Commands
                    </div>
                    <table class="symbol-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Action</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="symbol-code">F</span></td>
                                <td>Move Forward & Draw</td>
                                <td>
                                    Move forward one unit and draw a line
                                    segment
                                </td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">f</span></td>
                                <td>Move Forward (No Draw)</td>
                                <td>Move forward one unit without drawing</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">+</span></td>
                                <td>Turn Right</td>
                                <td>Turn right by the current angle (yaw)</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">-</span></td>
                                <td>Turn Left</td>
                                <td>Turn left by the current angle (yaw)</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">L</span></td>
                                <td>Draw Leaf</td>
                                <td>Generate a leaf at the current position</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="help-section-title">3D Rotation Commands</div>
                    <table class="symbol-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Action</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="symbol-code">&</span></td>
                                <td>Pitch Down</td>
                                <td>Rotate down around the right axis</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">^</span></td>
                                <td>Pitch Up</td>
                                <td>Rotate up around the right axis</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">\</span></td>
                                <td>Roll Left</td>
                                <td>Roll left around the forward axis</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">/</span></td>
                                <td>Roll Right</td>
                                <td>Roll right around the forward axis</td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">|</span></td>
                                <td>Turn Around</td>
                                <td>Turn 180 degrees</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="help-section-title">Branching Commands</div>
                    <table class="symbol-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Action</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="symbol-code">[</span></td>
                                <td>Push State</td>
                                <td>
                                    Save current position, direction, and
                                    properties to stack
                                </td>
                            </tr>
                            <tr>
                                <td><span class="symbol-code">]</span></td>
                                <td>Pop State</td>
                                <td>
                                    Restore saved position, direction, and
                                    properties from stack
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="help-section-title">Rule Syntax</div>
                    <div class="example-box">
                        <strong>Format:</strong>
                        <span class="symbol-code">Symbol -> Replacement</span>
                        <br /><br />
                        Each rule defines how to replace one symbol with a
                        sequence of symbols. Multiple rules should be separated
                        by new lines.
                    </div>

                    <div class="help-section-title">2D Examples</div>

                    <div class="example-box">
                        <strong>Simple Tree:</strong>
                        <div class="example-code">
                            Axiom: F Rules: F -> F[+F]F[-F]F
                        </div>
                        Creates a tree that branches left and right at each
                        growth point.
                    </div>

                    <div class="example-box">
                        <strong>Dragon Curve:</strong>
                        <div class="example-code">
                            Axiom: F Rules: F -> F+F--F+F
                        </div>
                        Creates a fractal dragon curve pattern.
                    </div>

                    <div class="help-section-title">3D Examples</div>

                    <div class="example-box">
                        <strong>3D Tree (6 directions):</strong>
                        <div class="example-code">
                            Axiom: F Rules: F -> F[&F][^F][+F][-F][/F][\F]
                        </div>
                        Branches in all six directions: up, down, left, right,
                        roll-left, roll-right.
                    </div>

                    <div class="example-box">
                        <strong>3D Spiral:</strong>
                        <div class="example-code">
                            Axiom: A Rules: A -> F[&A][/A][\A][^A] F -> FF
                        </div>
                        Creates a 3D spiral structure with multiple branching
                        levels.
                    </div>

                    <div class="help-section-title">Natural Variation</div>
                    <div class="example-box">
                        <strong>Angle Variation:</strong>
                        Use the "Angle Variation" slider to add randomness to
                        branching angles. This makes structures look more
                        organic and natural by introducing slight variations
                        (¬±0¬∞ to ¬±15¬∞) to each turn command.
                        <br /><br />
                        <strong>Effect:</strong> Instead of perfectly regular
                        branching, each + - & ^ \ / command will use a slightly
                        different angle, creating more realistic plant-like
                        structures.
                    </div>

                    <div class="help-section-title">
                        Tips for Creating L-Systems
                    </div>
                    <ul>
                        <li>
                            <strong>Start Simple:</strong> Begin with basic 2D
                            patterns before moving to 3D
                        </li>
                        <li>
                            <strong>Use Variables:</strong> Letters like X, A, B
                            can represent abstract growth without drawing
                        </li>
                        <li>
                            <strong>Balance Complexity:</strong> Too many
                            iterations can create overly complex structures
                        </li>
                        <li>
                            <strong>Experiment with Angles:</strong> Different
                            angles (15¬∞, 30¬∞, 45¬∞, 60¬∞, 90¬∞) create different
                            aesthetics
                        </li>
                        <li>
                            <strong>Combine Operations:</strong> Mix rotations
                            like <span class="symbol-code">[&+F]</span> for
                            diagonal branching
                        </li>
                        <li>
                            <strong>Use Multiple Rules:</strong> Complex systems
                            often need rules for different symbols
                        </li>
                        <li>
                            <strong>Add Natural Variation:</strong> Use angle
                            variation (2-8¬∞) to make structures look more
                            organic and less mathematically perfect
                        </li>
                    </ul>

                    <div class="help-section-title">Save & Load Features</div>
                    <ul>
                        <li>
                            <strong>Save Plants:</strong> Preserve all
                            parameters, leaf colors, and camera position
                        </li>
                        <li>
                            <strong>Load Plants:</strong> Restore complete plant
                            configurations instantly
                        </li>
                        <li>
                            <strong>Export/Import:</strong> Share your creations
                            or backup your collection
                        </li>
                        <li>
                            <strong>Local Storage:</strong> Plants are
                            automatically saved in your browser
                        </li>
                    </ul>

                    <div class="help-section-title">Keyboard Shortcuts</div>
                    <ul>
                        <li><strong>Ctrl+S:</strong> Save current plant</li>
                        <li>
                            <strong>Ctrl+O:</strong> Quick load first saved
                            plant
                        </li>
                        <li><strong>Ctrl+E:</strong> Export all plants</li>
                        <li>
                            <strong>Ctrl+Enter:</strong> Generate L-System (in
                            text areas)
                        </li>
                        <li>
                            <strong>Escape:</strong> Clear inputs or close
                            dropdowns
                        </li>
                        <li><strong>Mouse Wheel:</strong> Zoom in/out</li>
                        <li><strong>Alt+Drag:</strong> Pan camera</li>
                        <li><strong>Drag:</strong> Rotate camera</li>
                    </ul>

                    <div class="help-section-title">Performance Notes</div>
                    <ul>
                        <li>
                            Keep iterations low (3-6) for complex rules to avoid
                            performance issues
                        </li>
                        <li>
                            The system automatically limits string length to
                            prevent browser freezing
                        </li>
                        <li>
                            Simple rules can handle more iterations than complex
                            branching rules
                        </li>
                        <li>
                            Use the geometry parameters to fine-tune the visual
                            appearance
                        </li>
                    </ul>

                    <div class="help-section-title">
                        üé® Parameterized Colors
                    </div>
                    <div class="example-box">
                        <strong>New Feature:</strong> Add colors directly to
                        symbols using <code>{color:value}</code> syntax
                    </div>

                    <div class="example-box">
                        <strong>Basic Syntax:</strong>
                        <div class="example-code">
                            L{color:green} - Green leaf<br />
                            F{color:brown} - Brown branch<br />
                            L{color:#FF0000} - Red leaf (hex)<br />
                            F{color:FABC34E4} - Semi-transparent branch (RGBA)
                        </div>
                    </div>

                    <div class="example-box">
                        <strong>In Rules:</strong>
                        <div class="example-code">
                            F ->
                            F{color:bark_brown}[+L{color:leaf_green}][-L{color:autumn_red}]<br />
                            L{color:green} ->
                            L{color:autumn_orange}[+L{color:autumn_yellow}]
                        </div>
                    </div>

                    <div class="example-box">
                        <strong>Named Colors:</strong> red, green, blue, brown,
                        leaf_green, bark_brown, dark_green, autumn_red,
                        autumn_orange, autumn_yellow
                    </div>

                    <div class="example-box">
                        <strong>üí° Remember:</strong> Set Color Mode to
                        "Parameterized Colors" to enable this feature!
                    </div>
                </div>
            </div>
        </div>

        <script type="module" src="dist/index.js"></script>
        <script>
            function showHelp() {
                document.getElementById("helpModal").style.display = "block";
            }

            function closeHelp() {
                document.getElementById("helpModal").style.display = "none";
            }

            function setLeafColor(color) {
                document.getElementById("leafColor").value = color;
                document
                    .getElementById("leafColor")
                    .dispatchEvent(new Event("change"));
            }

            function showColorExamples() {
                const examples = `
üé® Parameterized Color Syntax Examples:

Basic colored symbols:
‚Ä¢ L{color:green} - Green leaf using named color
‚Ä¢ F{color:#8B4513} - Brown branch using hex color
‚Ä¢ L{color:FABC34E4} - Leaf with RGBA hex (alpha support)

Complex rules with colors:
‚Ä¢ F -> F{color:brown}[+L{color:green}][-L{color:red}]
‚Ä¢ L{color:green} -> L{color:autumn_orange}L{color:autumn_red}

Named colors available:
‚Ä¢ red, green, blue, brown
‚Ä¢ leaf_green, bark_brown
‚Ä¢ autumn_red, autumn_orange, autumn_yellow
‚Ä¢ dark_green

Try these examples:
1. Simple colored tree:
   Axiom: F
   Rule: F -> F{color:brown}[+L{color:green}][-L{color:green}]F

2. Autumn tree:
   Axiom: F
   Rule: F -> F{color:bark_brown}[+L{color:autumn_red}][-L{color:autumn_orange}]

3. Multi-colored fern:
   Axiom: X
   Rule: X -> F{color:green}[+X{color:leaf_green}]F[-X{color:dark_green}]+X
   Rule: F -> FF{color:brown}

üí° Don't forget to set Color Mode to "Parameterized Colors" to see the colors!
                `;

                alert(examples);

                // Auto-set color mode to parameterized colors
                const colorModeSelect = document.getElementById("colorMode");
                if (colorModeSelect && colorModeSelect.value !== "4") {
                    colorModeSelect.value = "4";
                    colorModeSelect.dispatchEvent(new Event("change"));
                }
            }

            function insertColorTemplate() {
                const templates = [
                    "F{color:bark_brown}[+L{color:leaf_green}][-L{color:autumn_red}]",
                    "L{color:green} -> L{color:autumn_orange}[+L{color:autumn_yellow}]",
                    "A{color:brown}[&+A{color:red}][&-A{color:blue}][^+A{color:green}]",
                    "F{color:#8B4513}[+L{color:#32CD32}][-L{color:#FF6347}]",
                ];

                const selectedTemplate =
                    templates[Math.floor(Math.random() * templates.length)];

                const rulesTextarea = document.getElementById("rules");
                if (rulesTextarea) {
                    const currentValue = rulesTextarea.value.trim();
                    const newValue = currentValue
                        ? currentValue + "\n" + selectedTemplate
                        : selectedTemplate;

                    rulesTextarea.value = newValue;
                    rulesTextarea.focus();

                    // Trigger change event to update the system
                    rulesTextarea.dispatchEvent(new Event("input"));
                }

                // Auto-set color mode to parameterized colors
                const colorModeSelect = document.getElementById("colorMode");
                if (colorModeSelect && colorModeSelect.value !== "4") {
                    colorModeSelect.value = "4";
                    colorModeSelect.dispatchEvent(new Event("change"));
                }

                // Show a brief tip
                const insertBtn = document.getElementById("insertColorBtn");
                if (insertBtn) {
                    const originalText = insertBtn.textContent;
                    insertBtn.textContent = "‚úì Template Added!";
                    insertBtn.style.background =
                        "linear-gradient(45deg, #16a34a, #15803d)";

                    setTimeout(() => {
                        insertBtn.textContent = originalText;
                        insertBtn.style.background =
                            "linear-gradient(45deg, #10b981, #059669)";
                    }, 2000);
                }
            }

            function testColorRendering() {
                console.log("=== MANUAL COLOR RENDERING TEST ===");

                // Set a simple colored rule
                document.getElementById("axiom").value = "F";
                document.getElementById("rules").value =
                    "F -> F{color:red}[+L{color:green}]";
                document.getElementById("iterations").value = "2";

                // Force color mode to parameterized colors
                const colorModeSelect = document.getElementById("colorMode");
                colorModeSelect.value = "4";
                colorModeSelect.dispatchEvent(new Event("change"));

                // Generate after a short delay
                setTimeout(() => {
                    document.getElementById("generate").click();
                }, 200);

                // Show feedback
                const testBtn = document.getElementById("testColorBtn");
                const originalText = testBtn.textContent;
                testBtn.textContent = "üî¨ Testing...";
                testBtn.style.background =
                    "linear-gradient(45deg, #f59e0b, #d97706)";

                setTimeout(() => {
                    testBtn.textContent = "‚úì Test Complete - Check Console";
                    testBtn.style.background =
                        "linear-gradient(45deg, #10b981, #059669)";

                    setTimeout(() => {
                        testBtn.textContent = originalText;
                        testBtn.style.background =
                            "linear-gradient(45deg, #ef4444, #dc2626)";
                    }, 3000);
                }, 1000);
            }

            function testCompletePipeline() {
                console.log("=== COMPLETE PIPELINE TEST ===");

                // Step 1: Set up simple test case
                const axiom = "F";
                const rule = "F -> F{color:red}[+L{color:green}]";
                console.log(`Testing: "${axiom}" with rule "${rule}"`);

                // Step 2: Force color mode to parameterized colors
                const colorModeSelect = document.getElementById("colorMode");
                colorModeSelect.value = "4";
                colorModeSelect.dispatchEvent(new Event("change"));
                console.log("‚úì Set color mode to Parameterized Colors");

                // Step 3: Set the test values in UI
                document.getElementById("axiom").value = axiom;
                document.getElementById("rules").value = rule;
                document.getElementById("iterations").value = "1";

                // Step 4: Trigger generation
                setTimeout(() => {
                    console.log("‚úì Triggering generation...");
                    document.getElementById("generate").click();
                }, 200);

                console.log(
                    "Pipeline test initiated - check console for results",
                );
            }

            // Make test function available globally
            window.testCompletePipeline = testCompletePipeline;

            // Close modal when clicking outside of it
            window.onclick = function (event) {
                const modal = document.getElementById("helpModal");
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            };

            // Close modal with Escape key
            document.addEventListener("keydown", function (event) {
                if (event.key === "Escape") {
                    closeHelp();
                }
            });
        </script>
    </body>
</html>
